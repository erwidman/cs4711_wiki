<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- CSS  -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
<!--example article http://127.0.0.1:8080/get_article_function.html?articleid=1403-->
    <nav class="light-blue lighten-1" role="navigation">
        <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">Wiki team 2</a>
            <ul class="right hide-on-med-and-down">
                <li><a href="/get_all_articles_function.html">Articles</a></li>
            </ul>

            <!-- ADDED LOGIN BUTTON -->
            <ul class="right hide-on-med-and-down">
                <li class = "includedContent" id="includedContent"></li>
            </ul>

            <ul id="nav-mobile" class="sidenav">
                <li><a href="#">Navbar Link</a></li>
            </ul>
            <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        </div>

    </nav>
<style>
    .user-image {
        width:100%;
    }
</style>
</head>
<body>
<div class="row">

<h1 id="article-title" class="col s4 offset-s1">
</h1>

</div>
<div class="row">

<div class="col s11 offset-s1">
    <div id="article-content">

    </div>
</div>
</div>
<!--id for now-->
<div class="row">

<div id="article-author" class="col s11 offset-s1">
</div>
<div id="article-last-update" class="col s11 offset-s1">
</div>
</div>
<div class="row">

<button id="edit-article" class="btn-large col s3 offset-s1">Edit Article</button>

<button id="show-history" class="btn-large col s3 offset-s1">Show History</button>
    <button id="lock-article" class="btn-large col s3 offset-s1 disabled">lock Article</button>

</div><!--history div is populated with show history function. it puts a <ul><il> here-->
<div class="row">
<div id="history" class="col s11 offset-s1">
</div>

</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="js/functions.js"></script>
<script src="js/materialize.min.js"></script>
<script>
    $( document ).ready(function() {
        getArticle({articleid: getParameterByName('articleid')});
        if(localStorage.getItem('admin') == "true"){
            $('#lock-article').removeClass('disabled')
        }
    });

    /**
     *
     * @param [args.articleid] - articles id
     * @param [args.successCallback] - functions used when ajax is successful
     * @param [args.failureCallback] - functions used when ajax fails
     */
    function getArticle(args){
        $.ajax({
            url: '/request?command=getArticle&0='+ args.articleid,
            async: true,
            dataType: "json",
            success: function(result){
                console.log(result);
                $('#article-title').html(result.title);
               $('#article-content').html(result.content);
               $('#article-author').html("Author ID: " + result.owner);
               $('#article-last-update').html("Last Updated: " + result.lastUpdated);

            },
            error: args.failureCallback || function () {
                alert("error in createArticle")
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader('authorization', args.password);
            }
        })
    }

    $('#edit-article').on('click', function(){
        location.href = '/edit_article.html?articleid='+getParameterByName('articleid');
    });

    $('#show-history').on('click', function(){
        getHistory({articleid: getParameterByName('articleid')});
    })

    function getHistory(args){
        $.ajax({
            url: '/request?command=getArticleHistory&0='+ args.articleid,
            async: true,
            dataType: "json",
            success: function(result){
                console.log(result);
                var html = '<ul>';
                for(var i = 0; i < result.length; i +=1){
                   html+= '<li>' + result[i].newContent + '<br> By UserID' + result[i].userid+ '<br> Time:'+ result[i].updateTime+ '</li>'
                }
                html+='</ul>';
                $('#history').html(html);
            },
            error: args.failureCallback || function () {
                alert("error in createArticle")
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader('authorization', args.password);
            }
        })
    }

</script>
</html>
